---
layout: post
title: CoreDNS指南
categories: sample-posts
---

<html lang="zh-CN" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoreDNS 完全指南</title>
    <!-- TailwindCSS 3.0+ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Preline UI -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/preline/dist/preline.min.css" />
    <!-- 代码高亮 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Mermaid 图表 -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        // 初始化 TailwindCSS 配置
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#ebcdf4',
                            100: '#dfb7ec',
                            200: '#d19ee1',
                            300: '#bf77d5',
                            400: '#a736c9',
                            500: '#8826a6',
                            600: '#681980',
                            700: '#58116e',
                            800: '#410a52',
                            900: '#24062d'
                        },
                        secondary: {
                            50: '#dcf5d4',
                            100: '#c9eebd',
                            200: '#b3e3a4',
                            300: '#92d77d',
                            400: '#5dcc3c',
                            500: '#46ae27',
                            600: '#33881a',
                            700: '#297612',
                            800: '#1d5a0b',
                            900: '#113606'
                        },
                        neutral: {
                            50: '#ffffff',
                            100: '#ffffff',
                            200: '#ffffff',
                            300: '#ffffff',
                            400: '#f3f2f3',
                            500: '#ddd5dc',
                            600: '#c9b6c7',
                            700: '#c2a3be',
                            800: '#b989b3',
                            900: '#aa6fa2'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        serif: ['Georgia', 'serif']
                    }
                }
            }
        }
    </script>
    <style>
        /* 自定义样式 */
        .transition-all {
            transition-property: all;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 300ms;
        }
        
        .table-wrapper {
            overflow-x: auto;
            margin: 1.5rem 0;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        code {
            font-family: 'Fira Code', monospace;
            font-size: 0.9em;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* 深色模式特定样式 */
        .dark .table-wrapper {
            box-shadow: 0 4px 6px -1px rgba(255, 255, 255, 0.05), 0 2px 4px -1px rgba(255, 255, 255, 0.03);
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        /* 垂直文字排版样式 */
        .writing-vertical {
            writing-mode: vertical-rl;
            text-orientation: upright;
            white-space: nowrap;
            display: inline-block;
            line-height: 1.4;
            letter-spacing: 0.05em;
        }
        
        /* 移动端水平文字样式 */
        .writing-horizontal {
            writing-mode: horizontal-tb;
            text-orientation: mixed;
            white-space: normal;
            line-height: 1.5;
            letter-spacing: normal;
        }
        
        /* 移动端侧边栏样式 */
        @media (max-width: 1023px) {
            #toc-sidebar.fixed {
                display: flex;
                flex-direction: column;
                padding: 3rem 1.5rem;
                overflow-y: auto;
            }
            
            #toc-sidebar.fixed .writing-vertical {
                writing-mode: horizontal-tb;
                text-orientation: mixed;
                white-space: normal;
                line-height: 1.5;
                letter-spacing: normal;
            }
            
            #toc-sidebar.fixed nav {
                width: 100%;
            }
            
            #toc-sidebar.fixed .mb-8 {
                margin-bottom: 1rem;
                border-left: none;
                border-bottom: 1px solid #e5e7eb;
                padding-bottom: 0.5rem;
            }
            
            #toc-sidebar.fixed a {
                text-align: left;
                padding: 0.75rem 0;
            }
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-100 transition-colors duration-300 font-serif">
    <!-- 顶部导航 -->
    <nav class="sticky top-0 z-30 bg-white/90 dark:bg-gray-900/90 backdrop-blur-md border-b border-gray-200 dark:border-gray-800">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <div class="p-1.5 rounded-lg bg-primary-500/10 text-primary-600 dark:text-primary-400">
                        <span class="material-icons text-xl">dns</span>
                    </div>
                    <h1 class="text-xl font-bold font-sans text-gray-800 dark:text-gray-100">CoreDNS 解析指南</h1>
                </div>
                
                <div class="flex items-center space-x-5">
                    <!-- 主要导航链接 - 仅在大屏幕显示 -->
                    <div class="hidden md:flex space-x-6">
                        <a href="#section-1-1" class="text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors">基础架构</a>
                        <a href="#section-2-1" class="text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors">对比分析</a>
                        <a href="#best-practices" class="text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors">最佳实践</a>
                    </div>
                    
                    <!-- 操作按钮 -->
                    <div class="flex items-center space-x-3">
                        <!-- 深色/浅色模式切换 -->
                        <button id="theme-toggle" class="p-2 rounded-full bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-all text-gray-700 dark:text-gray-300">
                            <span class="material-icons text-sm block dark:hidden">dark_mode</span>
                            <span class="material-icons text-sm hidden dark:block">light_mode</span>
                        </button>
                        
                        <!-- 目录按钮 -->
                        <button id="toc-button" class="p-2 rounded-full bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-all text-gray-700 dark:text-gray-300 md:hidden">
                            <span class="material-icons text-sm">menu</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主要内容区域 -->
    <div class="container mx-auto px-6 py-10 flex flex-col lg:flex-row">
        <!-- 侧边栏目录 - 新设计 -->
        <aside id="toc-sidebar" class="w-16 hidden lg:block fixed lg:sticky top-20 h-[calc(100vh-5rem)] overflow-y-auto py-6 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 transition-all">
            <div class="flex flex-col items-center h-full">
                <!-- 侧边栏导航 -->
                <nav class="w-full space-y-6">
                    <a href="#section-1-1" class="block py-3 relative group">
                        <div class="flex flex-col items-center">
                            <span class="material-icons text-gray-500 dark:text-gray-400 group-hover:text-primary-500 dark:group-hover:text-primary-400">description</span>
                            <span class="text-xs font-medium mt-1 text-gray-700 dark:text-gray-300 group-hover:text-primary-600 dark:group-hover:text-primary-400">1.1</span>
                        </div>
                        <div class="absolute left-0 top-0 h-full w-1 bg-transparent group-hover:bg-primary-500 transition-all"></div>
                    </a>
                    
                    <a href="#section-1-2" class="block py-3 relative group">
                        <div class="flex flex-col items-center">
                            <span class="material-icons text-gray-500 dark:text-gray-400 group-hover:text-primary-500 dark:group-hover:text-primary-400">settings</span>
                            <span class="text-xs font-medium mt-1 text-gray-700 dark:text-gray-300 group-hover:text-primary-600 dark:group-hover:text-primary-400">1.2</span>
                        </div>
                        <div class="absolute left-0 top-0 h-full w-1 bg-transparent group-hover:bg-primary-500 transition-all"></div>
                    </a>
                    
                    <a href="#section-2-1" class="block py-3 relative group">
                        <div class="flex flex-col items-center">
                            <span class="material-icons text-gray-500 dark:text-gray-400 group-hover:text-primary-500 dark:group-hover:text-primary-400">compare</span>
                            <span class="text-xs font-medium mt-1 text-gray-700 dark:text-gray-300 group-hover:text-primary-600 dark:group-hover:text-primary-400">2.1</span>
                        </div>
                        <div class="absolute left-0 top-0 h-full w-1 bg-transparent group-hover:bg-primary-500 transition-all"></div>
                    </a>
                    
                    <a href="#section-2-2" class="block py-3 relative group">
                        <div class="flex flex-col items-center">
                            <span class="material-icons text-gray-500 dark:text-gray-400 group-hover:text-primary-500 dark:group-hover:text-primary-400">rocket_launch</span>
                            <span class="text-xs font-medium mt-1 text-gray-700 dark:text-gray-300 group-hover:text-primary-600 dark:group-hover:text-primary-400">2.2</span>
                        </div>
                        <div class="absolute left-0 top-0 h-full w-1 bg-transparent group-hover:bg-primary-500 transition-all"></div>
                    </a>
                    
                    <a href="#section-3-1" class="block py-3 relative group">
                        <div class="flex flex-col items-center">
                            <span class="material-icons text-gray-500 dark:text-gray-400 group-hover:text-primary-500 dark:group-hover:text-primary-400">code</span>
                            <span class="text-xs font-medium mt-1 text-gray-700 dark:text-gray-300 group-hover:text-primary-600 dark:group-hover:text-primary-400">3.1</span>
                        </div>
                        <div class="absolute left-0 top-0 h-full w-1 bg-transparent group-hover:bg-primary-500 transition-all"></div>
                    </a>
                    
                    <a href="#section-3-2" class="block py-3 relative group">
                        <div class="flex flex-col items-center">
                            <span class="material-icons text-gray-500 dark:text-gray-400 group-hover:text-primary-500 dark:group-hover:text-primary-400">travel_explore</span>
                            <span class="text-xs font-medium mt-1 text-gray-700 dark:text-gray-300 group-hover:text-primary-600 dark:group-hover:text-primary-400">3.2</span>
                        </div>
                        <div class="absolute left-0 top-0 h-full w-1 bg-transparent group-hover:bg-primary-500 transition-all"></div>
                    </a>
                    
                    <a href="#section-4-1" class="block py-3 relative group">
                        <div class="flex flex-col items-center">
                            <span class="material-icons text-gray-500 dark:text-gray-400 group-hover:text-primary-500 dark:group-hover:text-primary-400">swap_horiz</span>
                            <span class="text-xs font-medium mt-1 text-gray-700 dark:text-gray-300 group-hover:text-primary-600 dark:group-hover:text-primary-400">4.1</span>
                        </div>
                        <div class="absolute left-0 top-0 h-full w-1 bg-transparent group-hover:bg-primary-500 transition-all"></div>
                    </a>
                    
                    <a href="#section-4-2" class="block py-3 relative group">
                        <div class="flex flex-col items-center">
                            <span class="material-icons text-gray-500 dark:text-gray-400 group-hover:text-primary-500 dark:group-hover:text-primary-400">check_circle</span>
                            <span class="text-xs font-medium mt-1 text-gray-700 dark:text-gray-300 group-hover:text-primary-600 dark:group-hover:text-primary-400">4.2</span>
                        </div>
                        <div class="absolute left-0 top-0 h-full w-1 bg-transparent group-hover:bg-primary-500 transition-all"></div>
                    </a>
                    
                    <a href="#section-5-1" class="block py-3 relative group">
                        <div class="flex flex-col items-center">
                            <span class="material-icons text-gray-500 dark:text-gray-400 group-hover:text-primary-500 dark:group-hover:text-primary-400">sync_alt</span>
                            <span class="text-xs font-medium mt-1 text-gray-700 dark:text-gray-300 group-hover:text-primary-600 dark:group-hover:text-primary-400">5.1</span>
                        </div>
                        <div class="absolute left-0 top-0 h-full w-1 bg-transparent group-hover:bg-primary-500 transition-all"></div>
                    </a>
                    
                    <a href="#section-5-2" class="block py-3 relative group">
                        <div class="flex flex-col items-center">
                            <span class="material-icons text-gray-500 dark:text-gray-400 group-hover:text-primary-500 dark:group-hover:text-primary-400">extension</span>
                            <span class="text-xs font-medium mt-1 text-gray-700 dark:text-gray-300 group-hover:text-primary-600 dark:group-hover:text-primary-400">5.2</span>
                        </div>
                        <div class="absolute left-0 top-0 h-full w-1 bg-transparent group-hover:bg-primary-500 transition-all"></div>
                    </a>
                    
                    <a href="#best-practices" class="block py-3 relative group">
                        <div class="flex flex-col items-center">
                            <span class="material-icons text-gray-500 dark:text-gray-400 group-hover:text-primary-500 dark:group-hover:text-primary-400">auto_awesome</span>
                            <span class="text-xs font-medium mt-1 text-gray-700 dark:text-gray-300 group-hover:text-primary-600 dark:group-hover:text-primary-400">最佳</span>
                        </div>
                        <div class="absolute left-0 top-0 h-full w-1 bg-transparent group-hover:bg-primary-500 transition-all"></div>
                    </a>
                    
                    <a href="#faq" class="block py-3 relative group">
                        <div class="flex flex-col items-center">
                            <span class="material-icons text-gray-500 dark:text-gray-400 group-hover:text-primary-500 dark:group-hover:text-primary-400">help</span>
                            <span class="text-xs font-medium mt-1 text-gray-700 dark:text-gray-300 group-hover:text-primary-600 dark:group-hover:text-primary-400">问题</span>
                        </div>
                        <div class="absolute left-0 top-0 h-full w-1 bg-transparent group-hover:bg-primary-500 transition-all"></div>
                    </a>
                </nav>
            </div>
        </aside>

        <!-- 主要文档内容 -->
        <main class="lg:ml-24 w-full max-w-4xl mx-auto">
            <div class="space-y-16 animate-fade-in">
                <!-- 1.1 CoreDNS 基础架构与功能 -->
                <section id="section-1-1" class="scroll-mt-20">
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-md">
                        <h2 class="text-2xl font-bold mb-6 text-primary-600 dark:text-primary-400 font-sans border-b pb-2 border-gray-200 dark:border-gray-700">1.1 CoreDNS 基础架构与功能</h2>
                        
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200 font-sans">核心功能与架构特点</h3>
                        
                        <ul class="space-y-4 list-disc pl-6">
                            <li class="card-hover bg-gray-50 dark:bg-gray-900 p-4 rounded-lg">
                                <strong class="text-primary-600 dark:text-primary-400">模块化插件机制</strong>：
                                CoreDNS 通过插件架构实现功能扩展，每个插件实现特定功能（如缓存、转发、日志），通过 
                                <strong class="bg-gray-100 dark:bg-gray-800 px-1 rounded">Corefile</strong> 
                                配置文件动态组合插件链。
                            </li>
                            
                            <li class="card-hover bg-gray-50 dark:bg-gray-900 p-4 rounded-lg">
                                <strong class="text-primary-600 dark:text-primary-400">多协议支持</strong>：
                                <ul class="list-disc pl-6 mt-2 space-y-1">
                                    <li>DNS (UDP/TCP)</li>
                                    <li>DNS-over-TLS (DoT)</li>
                                    <li>DNS-over-HTTPS (DoH)</li>
                                    <li>gRPC 协议</li>
                                </ul>
                            </li>
                            
                            <li class="card-hover bg-gray-50 dark:bg-gray-900 p-4 rounded-lg">
                                <strong class="text-primary-600 dark:text-primary-400">Kubernetes 集成优势</strong>：
                                <ol class="list-decimal pl-6 mt-2 space-y-1">
                                    <li>自动同步 Kubernetes Service/Endpoint 变化</li>
                                    <li>支持 <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">cluster.local</code> 域名的服务发现</li>
                                    <li>通过 <strong class="bg-gray-100 dark:bg-gray-800 px-1 rounded">autopath</strong> 插件优化 DNS 解析路径</li>
                                </ol>
                            </li>
                        </ul>
                        
                        <h4 class="text-lg font-semibold mt-6 mb-3 text-gray-800 dark:text-gray-200 font-sans">场景对比</h4>
                        
                        <div class="table-wrapper">
                            <table class="min-w-full divide-y divide-gray-300 dark:divide-gray-700">
                                <thead class="bg-gray-100 dark:bg-gray-800">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider">维度</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider">云原生环境</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider">传统 DNS 场景</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">配置更新频率</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">动态（秒级）</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">静态（人工修改）</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">服务发现</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">自动关联 Pod/Service</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">手动维护记录</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">扩展性</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">插件灵活组合</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">功能固化</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- 1.2 工作原理与插件链 -->
                <section id="section-1-2" class="scroll-mt-20">
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-md">
                        <h2 class="text-2xl font-bold mb-6 text-primary-600 dark:text-primary-400 font-sans border-b pb-2 border-gray-200 dark:border-gray-700">1.2 工作原理与插件链</h2>
                        
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200 font-sans">处理流程</h3>
                        
                        <div class="bg-gray-50 dark:bg-gray-900 p-4 rounded-lg mb-6">
                            <div class="mermaid">
                                graph TD
                                A[DNS请求] --> B{插件链处理}
                                B -->|1. 日志记录| C[log插件]
                                B -->|2. 缓存查询| D[cache插件]
                                B -->|3. 转发请求| E[forward插件]
                                E --> F[上游DNS服务器]
                            </div>
                        </div>
                        
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200 font-sans">插件顺序重要性</h3>
                        
                        <div class="card-hover bg-gray-50 dark:bg-gray-900 p-5 rounded-lg mb-6">
                            <p class="mb-4">
                                <strong class="text-primary-600 dark:text-primary-400">执行顺序决定处理逻辑</strong>：
                                例如 <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">cache</code> 插件在前会直接响应缓存结果，
                                若在 <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">forward</code> 后则缓存远程响应
                            </p>
                        </div>
                        
                        <h4 class="text-lg font-semibold mb-3 text-gray-800 dark:text-gray-200 font-sans">配置示例</h4>
                        
                        <div class="bg-gray-800 rounded-lg overflow-hidden">
                            <pre class="language-corefile p-4 text-sm overflow-auto text-gray-100" style="max-height: 300px;"><code>.:53 {
    # 日志记录插件
    log
    # 缓存 30 秒，排除 .nocache. 域名
    cache 30 {
        success 1024
        denial 512
        prefetch 10 30%
    }
    # 转发到 Google DNS
    forward . 8.8.8.8 8.8.4.4
}</code></pre>
                        </div>
                    </div>
                </section>

                <!-- 2.1 CoreDNS vs KubeDNS -->
                <section id="section-2-1" class="scroll-mt-20">
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-md">
                        <h2 class="text-2xl font-bold mb-6 text-primary-600 dark:text-primary-400 font-sans border-b pb-2 border-gray-200 dark:border-gray-700">2.1 CoreDNS vs KubeDNS</h2>
                        
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200 font-sans">对比表</h3>
                        
                        <div class="table-wrapper">
                            <table class="min-w-full divide-y divide-gray-300 dark:divide-gray-700">
                                <thead class="bg-gray-100 dark:bg-gray-800">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider">维度</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider">CoreDNS</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider">KubeDNS</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">架构</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">单进程+插件链</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">多组件（kube-dns+sidecar）</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">性能</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">更高 QPS（减少上下文切换）</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">较低</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">扩展性</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">支持 70+ 插件</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">无插件机制</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">协议支持</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">DoT/DoH/EDNS0</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">仅基础 DNS</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">维护状态</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">活跃开发</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">已弃用</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <h3 class="text-xl font-semibold mt-8 mb-4 text-gray-800 dark:text-gray-200 font-sans">KubeDNS 被替代原因</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="card-hover bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border-l-4 border-primary-500">
                                <div class="text-xl mb-2 text-primary-600 dark:text-primary-400">1</div>
                                <p>多组件架构导致性能瓶颈</p>
                            </div>
                            
                            <div class="card-hover bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border-l-4 border-primary-500">
                                <div class="text-xl mb-2 text-primary-600 dark:text-primary-400">2</div>
                                <p>缺乏动态扩展能力</p>
                            </div>
                            
                            <div class="card-hover bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border-l-4 border-primary-500">
                                <div class="text-xl mb-2 text-primary-600 dark:text-primary-400">3</div>
                                <p>社区支持转向 CoreDNS</p>
                            </div>
                        </div>
                        
                        <h4 class="text-lg font-semibold mb-3 text-gray-800 dark:text-gray-200 font-sans">默认配置验证</h4>
                        
                        <div class="bg-gray-800 rounded-lg overflow-hidden">
                            <pre class="language-bash p-4 text-sm overflow-auto text-gray-100"><code>kubectl get deployment -n kube-system coredns</code></pre>
                        </div>
                    </div>
                </section>

                <!-- 2.2 部署与验证 -->
                <section id="section-2-2" class="scroll-mt-20">
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-md">
                        <h2 class="text-2xl font-bold mb-6 text-primary-600 dark:text-primary-400 font-sans border-b pb-2 border-gray-200 dark:border-gray-700">2.2 部署与验证</h2>
                        
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200 font-sans">Helm 部署命令</h3>
                        
                        <div class="bg-gray-800 rounded-lg overflow-hidden mb-6">
                            <pre class="language-bash p-4 text-sm overflow-auto text-gray-100"><code>helm install coredns stable/coredns \
  --namespace kube-system \
  --set service.clusterIP=10.96.0.10</code></pre>
                        </div>
                        
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200 font-sans">验证方法</h3>
                        
                        <div class="bg-gray-50 dark:bg-gray-900 p-5 rounded-lg mb-6">
                            <ol class="list-decimal pl-6 space-y-4">
                                <li class="card-hover">
                                    <strong class="text-primary-600 dark:text-primary-400">端点检查</strong>：
                                    <div class="bg-gray-200 dark:bg-gray-800 rounded p-2 mt-2">
                                        <code>kubectl get endpoints coredns -n kube-system</code>
                                    </div>
                                </li>
                                
                                <li class="card-hover">
                                    <strong class="text-primary-600 dark:text-primary-400">解析测试</strong>：
                                    <div class="bg-gray-200 dark:bg-gray-800 rounded p-2 mt-2">
                                        <code>kubectl run -it --rm test --image=busybox --restart=Never -- nslookup kubernetes.default</code>
                                    </div>
                                </li>
                                
                                <li class="card-hover">
                                    <strong class="text-primary-600 dark:text-primary-400">日志查看</strong>：
                                    <div class="bg-gray-200 dark:bg-gray-800 rounded p-2 mt-2">
                                        <code>kubectl logs -l k8s-app=coredns -n kube-system</code>
                                    </div>
                                </li>
                            </ol>
                        </div>
                        
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200 font-sans">配置更新流程</h3>
                        
                        <div class="bg-gray-800 rounded-lg overflow-hidden">
                            <pre class="language-bash p-4 text-sm overflow-auto text-gray-100"><code>kubectl edit configmap coredns -n kube-system
# 修改后等待 30 秒自动热更新</code></pre>
                        </div>
                    </div>
                </section>

                <!-- 3.1 复杂配置示例 -->
                <section id="section-3-1" class="scroll-mt-20">
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-md">
                        <h2 class="text-2xl font-bold mb-6 text-primary-600 dark:text-primary-400 font-sans border-b pb-2 border-gray-200 dark:border-gray-700">3.1 复杂配置示例</h2>
                        
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200 font-sans">Corefile 配置</h3>
                        
                        <div class="bg-gray-800 rounded-lg overflow-hidden mb-6">
                            <pre class="language-corefile p-4 text-sm overflow-auto text-gray-100" style="max-height: 300px;"><code>example.com:53 {
    # 固定 IP 解析
    hosts {
        192.168.1.100 example.com
        fallthrough
    }
}

.:53 {
    # Kubernetes 服务发现
    kubernetes cluster.local {
        pods insecure
        upstream
    }
    # 缓存策略
    cache 300 {
        exclude "*.nocache.example.com"
    }
}</code></pre>
                        </div>
                        
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200 font-sans">验证命令</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-gray-50 dark:bg-gray-900 p-4 rounded-lg">
                                <pre class="language-bash text-sm text-gray-800 dark:text-gray-200"><code>dig @&lt;CoreDNS_IP&gt; example.com A</code></pre>
                            </div>
                            
                            <div class="bg-gray-50 dark:bg-gray-900 p-4 rounded-lg">
                                <pre class="language-bash text-sm text-gray-800 dark:text-gray-200"><code>dig @&lt;CoreDNS_IP&gt; kubernetes.default.svc.cluster.local A</code></pre>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 3.2 服务发现机制 -->
                <section id="section-3-2" class="scroll-mt-20">
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-md">
                        <h2 class="text-2xl font-bold mb-6 text-primary-600 dark:text-primary-400 font-sans border-b pb-2 border-gray-200 dark:border-gray-700">3.2 服务发现机制</h2>
                        
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200 font-sans">时序图</h3>
                        
                        <div class="bg-gray-50 dark:bg-gray-900 p-4 rounded-lg mb-6">
                            <div class="mermaid">
                                sequenceDiagram
                                Client->>CoreDNS: 查询 service.ns.svc.cluster.local
                                CoreDNS->>API Server: Watch Service/Endpoint
                                API Server-->>CoreDNS: 推送变更事件
                                CoreDNS->>Client: 返回解析结果
                            </div>
                        </div>
                        
                        <h3 class="text-xl font-semibold mb-4 mt-6 text-gray-800 dark:text-gray-200 font-sans">Headless Service 处理</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="card-hover bg-gray-50 dark:bg-gray-900 p-4 rounded-lg">
                                <span class="material-icons text-primary-500 dark:text-primary-400 mb-2">dns</span>
                                <p>直接返回所有 Pod IP（无 ClusterIP）</p>
                            </div>
                            
                            <div class="card-hover bg-gray-50 dark:bg-gray-900 p-4 rounded-lg">
                                <span class="material-icons text-primary-500 dark:text-primary-400 mb-2">settings_ethernet</span>
                                <p>通过 <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">SRV</code> 记录提供端口信息</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 4.1 跨 Namespace 转发 -->
                <section id="section-4-1" class="scroll-mt-20">
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-md">
                        <h2 class="text-2xl font-bold mb-6 text-primary-600 dark:text-primary-400 font-sans border-b pb-2 border-gray-200 dark:border-gray-700">4.1 跨 Namespace 转发</h2>
                        
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200 font-sans">Corefile 配置</h3>
                        
                        <div class="bg-gray-800 rounded-lg overflow-hidden mb-6">
                            <pre class="language-corefile p-4 text-sm overflow-auto text-gray-100"><code>namespace-a.svc.cluster.local {
    rewrite name substring namespace-a.svc.cluster.local namespace-b.svc.cluster.local
    forward . /etc/resolv.conf
    errors
}</code></pre>
                        </div>
                        
                        <div class="border-l-4 border-primary-500 pl-4 py-2 mb-6">
                            <p class="text-gray-700 dark:text-gray-300">
                                此配置将所有对 <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">namespace-a</code> 中服务的请求
                                重定向到 <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">namespace-b</code>，实现跨命名空间服务发现。
                            </p>
                        </div>
                        
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200 font-sans">验证命令</h3>
                        
                        <div class="bg-gray-50 dark:bg-gray-900 p-4 rounded-lg">
                            <pre class="language-bash text-sm text-gray-800 dark:text-gray-200"><code>curl http://service.namespace-a.svc.cluster.local</code></pre>
                        </div>
                    </div>
                </section>

                <!-- 4.2 配置验证方法 -->
                <section id="section-4-2" class="scroll-mt-20">
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-md">
                        <h2 class="text-2xl font-bold mb-6 text-primary-600 dark:text-primary-400 font-sans border-b pb-2 border-gray-200 dark:border-gray-700">4.2 配置验证方法</h2>
                        
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200 font-sans">验证步骤</h3>
                        
                        <div class="space-y-6">
                            <div class="card-hover bg-gray-50 dark:bg-gray-900 p-5 rounded-lg">
                                <div class="flex items-start">
                                    <div class="bg-primary-500 text-white rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0 mr-4">
                                        <span>1</span>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Busybox 测试</h4>
                                        <div class="bg-gray-800 rounded-lg overflow-hidden">
                                            <pre class="language-bash p-4 text-sm overflow-auto text-gray-100"><code>kubectl exec -it busybox -- nslookup service.namespace</code></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card-hover bg-gray-50 dark:bg-gray-900 p-5 rounded-lg">
                                <div class="flex items-start">
                                    <div class="bg-primary-500 text-white rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0 mr-4">
                                        <span>2</span>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">日志分析</h4>
                                        <div class="bg-gray-800 rounded-lg overflow-hidden">
                                            <pre class="language-log p-4 text-sm overflow-auto text-gray-100"><code>[INFO] 10.244.0.12:4321 - 38712 "A IN service.ns.svc.cluster.local."</code></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card-hover bg-gray-50 dark:bg-gray-900 p-5 rounded-lg">
                                <div class="flex items-start">
                                    <div class="bg-primary-500 text-white rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0 mr-4">
                                        <span>3</span>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Prometheus 指标</h4>
                                        <div class="bg-gray-800 rounded-lg overflow-hidden">
                                            <pre class="language-promql p-4 text-sm overflow-auto text-gray-100"><code>coredns_dns_request_count_total{zone="cluster.local"}</code></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 5.1 转发规则注意事项 -->
                <section id="section-5-1" class="scroll-mt-20">
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-md">
                        <h2 class="text-2xl font-bold mb-6 text-primary-600 dark:text-primary-400 font-sans border-b pb-2 border-gray-200 dark:border-gray-700">5.1 转发规则注意事项</h2>
                        
                        <div class="table-wrapper">
                            <table class="min-w-full divide-y divide-gray-300 dark:divide-gray-700">
                                <thead class="bg-gray-100 dark:bg-gray-800">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider">问题描述</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider">解决方案</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider">配置示例</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800">
                                    <tr>
                                        <td class="px-6 py-4 text-sm font-medium text-gray-900 dark:text-gray-100">上游服务器不可达</td>
                                        <td class="px-6 py-4 text-sm text-gray-700 dark:text-gray-300">多备份服务器配置</td>
                                        <td class="px-6 py-4 text-sm text-gray-700 dark:text-gray-300 font-mono bg-gray-50 dark:bg-gray-800 rounded">forward . 1.1.1.1 9.9.9.9</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 text-sm font-medium text-gray-900 dark:text-gray-100">未加密通信风险</td>
                                        <td class="px-6 py-4 text-sm text-gray-700 dark:text-gray-300">启用 DoT</td>
                                        <td class="px-6 py-4 text-sm text-gray-700 dark:text-gray-300 font-mono bg-gray-50 dark:bg-gray-800 rounded">forward . tls://8.8.8.8</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 text-sm font-medium text-gray-900 dark:text-gray-100">缓存污染</td>
                                        <td class="px-6 py-4 text-sm text-gray-700 dark:text-gray-300">设置合理 TTL</td>
                                        <td class="px-6 py-4 text-sm text-gray-700 dark:text-gray-300 font-mono bg-gray-50 dark:bg-gray-800 rounded">cache 60</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="bg-yellow-50 dark:bg-yellow-900/30 border-l-4 border-yellow-500 p-4 mt-6 rounded-r">
                            <div class="flex">
                                <div class="flex-shrink-0">
                                    <span class="material-icons text-yellow-500">warning</span>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-yellow-700 dark:text-yellow-200">
                                        注意：配置多个上游服务器时，CoreDNS 会优先使用第一个可用服务器，仅在超时或失败时尝试后续服务器。
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 5.2 插件开发基础 -->
                <section id="section-5-2" class="scroll-mt-20">
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-md">
                        <h2 class="text-2xl font-bold mb-6 text-primary-600 dark:text-primary-400 font-sans border-b pb-2 border-gray-200 dark:border-gray-700">5.2 插件开发基础</h2>
                        
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200 font-sans">必要接口</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="card-hover bg-gray-50 dark:bg-gray-900 p-4 rounded-lg">
                                <div class="text-xl mb-2 text-primary-600 dark:text-primary-400 font-mono">1. ServeDNS</div>
                                <p>处理 DNS 请求</p>
                            </div>
                            
                            <div class="card-hover bg-gray-50 dark:bg-gray-900 p-4 rounded-lg">
                                <div class="text-xl mb-2 text-primary-600 dark:text-primary-400 font-mono">2. Name</div>
                                <p>返回插件名称</p>
                            </div>
                        </div>
                        
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200 font-sans">代码框架</h3>
                        
                        <div class="bg-gray-800 rounded-lg overflow-hidden">
                            <pre class="language-go p-4 text-sm overflow-auto text-gray-100"><code>package main

type MyPlugin struct{}

func (p MyPlugin) ServeDNS(ctx context.Context, w dns.ResponseWriter, r *dns.Msg) (int, error) {
    // 重写逻辑
    return dns.NextPluginSuccess
}

func (p MyPlugin) Name() string { return "myplugin" }</code></pre>
                        </div>
                    </div>
                </section>

                <!-- 最佳实践总结 -->
                <section id="best-practices" class="scroll-mt-20">
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-md">
                        <h2 class="text-2xl font-bold mb-6 text-primary-600 dark:text-primary-400 font-sans border-b pb-2 border-gray-200 dark:border-gray-700">最佳实践总结</h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                            <div class="card-hover bg-gray-50 dark:bg-gray-900 p-5 rounded-lg shadow-sm">
                                <div class="flex items-center justify-center mb-4">
                                    <span class="material-icons text-3xl text-primary-500 dark:text-primary-400">tune</span>
                                </div>
                                <h3 class="font-semibold text-center mb-2">插件精简</h3>
                                <p class="text-center text-gray-700 dark:text-gray-300">仅启用必要插件以减少资源消耗</p>
                            </div>
                            
                            <div class="card-hover bg-gray-50 dark:bg-gray-900 p-5 rounded-lg shadow-sm">
                                <div class="flex items-center justify-center mb-4">
                                    <span class="material-icons text-3xl text-primary-500 dark:text-primary-400">monitoring</span>
                                </div>
                                <h3 class="font-semibold text-center mb-2">监控告警</h3>
                                <p class="text-center text-gray-700 dark:text-gray-300">监控 <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded text-xs">coredns_dns_response_rcode_count</code> 指标</p>
                            </div>
                            
                            <div class="card-hover bg-gray-50 dark:bg-gray-900 p-5 rounded-lg shadow-sm">
                                <div class="flex items-center justify-center mb-4">
                                    <span class="material-icons text-3xl text-primary-500 dark:text-primary-400">security</span>
                                </div>
                                <h3 class="font-semibold text-center mb-2">安全加固</h3>
                                <p class="text-center text-gray-700 dark:text-gray-300">启用 DoT/DoH 防止 DNS 劫持</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 常见问题排查 -->
                <section id="faq" class="scroll-mt-20">
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-md">
                        <h2 class="text-2xl font-bold mb-6 text-primary-600 dark:text-primary-400 font-sans border-b pb-2 border-gray-200 dark:border-gray-700">常见问题排查清单</h2>
                        
                        <div class="space-y-4">
                            <div class="card-hover flex items-start p-4 bg-gray-50 dark:bg-gray-900 rounded-lg">
                                <div class="mr-4 text-red-500 dark:text-red-400">
                                    <span class="material-icons">error</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-800 dark:text-gray-200 mb-1">解析超时</h3>
                                    <p class="text-gray-700 dark:text-gray-300">检查上游 DNS 可达性</p>
                                </div>
                            </div>
                            
                            <div class="card-hover flex items-start p-4 bg-gray-50 dark:bg-gray-900 rounded-lg">
                                <div class="mr-4 text-red-500 dark:text-red-400">
                                    <span class="material-icons">error</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-800 dark:text-gray-200 mb-1">NXDOMAIN 错误</h3>
                                    <p class="text-gray-700 dark:text-gray-300">验证 Service 标签匹配</p>
                                </div>
                            </div>
                            
                            <div class="card-hover flex items-start p-4 bg-gray-50 dark:bg-gray-900 rounded-lg">
                                <div class="mr-4 text-red-500 dark:text-red-400">
                                    <span class="material-icons">error</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-800 dark:text-gray-200 mb-1">日志无输出</h3>
                                    <p class="text-gray-700 dark:text-gray-300">检查 <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">log</code> 插件是否加载</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- JavaScript -->
    <script>
        // 初始化 Mermaid 图表
        mermaid.initialize({ 
            theme: 'default',
            securityLevel: 'loose'
        });
        
        // 代码高亮
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
        });
        
        // 深色/浅色模式切换
        const themeToggle = document.getElementById('theme-toggle');
        themeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            
            // 存储主题偏好
            const isDark = document.documentElement.classList.contains('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });
        
        // 检查用户主题偏好
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
        
        // 移动端目录切换
        const tocButton = document.getElementById('toc-button');
        const tocSidebar = document.getElementById('toc-sidebar');
        
        tocButton.addEventListener('click', () => {
            tocSidebar.classList.toggle('hidden');
            
            // 当在移动设备上时，侧边栏应该是全屏固定的
            if (window.innerWidth < 1024) {
                tocSidebar.classList.toggle('lg:block');
                tocSidebar.classList.toggle('fixed');
                tocSidebar.classList.toggle('inset-0');
                tocSidebar.classList.toggle('w-full');
                tocSidebar.classList.toggle('z-50');
                tocSidebar.classList.toggle('h-full');
                
                // 移动设备上的侧边栏样式
                if (!tocSidebar.classList.contains('hidden')) {
                    // 只在第一次切换时添加样式
                    if (!tocSidebar.classList.contains('mobile-style-applied')) {
                        tocSidebar.classList.add('mobile-style-applied');
                        
                        // 在移动设备上更改导航样式
                        const nav = tocSidebar.querySelector('nav');
                        nav.classList.remove('space-y-6');
                        nav.classList.add('grid', 'grid-cols-3', 'gap-4', 'p-4', 'mt-10');
                        
                        // 更改链接样式
                        const links = nav.querySelectorAll('a');
                        links.forEach(link => {
                            link.classList.add('bg-gray-100', 'dark:bg-gray-800', 'rounded-lg', 'p-4', 'flex', 'flex-col', 'items-center', 'justify-center');
                            
                            // 移除左侧边框指示器
                            const indicator = link.querySelector('div.absolute');
                            if (indicator) {
                                indicator.remove();
                            }
                        });
                    }
                    
                    // 仅在首次显示时添加关闭按钮
                    if (!document.getElementById('close-sidebar')) {
                        const closeButton = document.createElement('button');
                        closeButton.id = 'close-sidebar';
                        closeButton.className = 'absolute top-4 right-4 p-2 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300';
                        closeButton.innerHTML = '<span class="material-icons">close</span>';
                        closeButton.addEventListener('click', () => {
                            tocSidebar.classList.add('hidden');
                            tocSidebar.classList.remove('fixed', 'inset-0', 'w-full', 'z-50', 'h-full');
                        });
                        tocSidebar.appendChild(closeButton);
                        
                        // 添加标题
                        const title = document.createElement('h3');
                        title.className = 'text-xl font-bold text-center absolute top-4 left-0 right-0';
                        title.textContent = '内容导航';
                        tocSidebar.appendChild(title);
                    }
                } else {
                    // 恢复初始状态
                    if (tocSidebar.classList.contains('mobile-style-applied')) {
                        const nav = tocSidebar.querySelector('nav');
                        nav.classList.add('space-y-6');
                        nav.classList.remove('grid', 'grid-cols-3', 'gap-4', 'p-4', 'mt-10');
                        
                        const links = nav.querySelectorAll('a');
                        links.forEach(link => {
                            link.classList.remove('bg-gray-100', 'dark:bg-gray-800', 'rounded-lg', 'p-4', 'flex', 'flex-col', 'items-center', 'justify-center');
                        });
                        
                        tocSidebar.classList.remove('mobile-style-applied');
                    }
                }
            }
        });
        
        // 搜索功能
        const searchInput = document.getElementById('search-input');
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            
            // 如果搜索输入为空，重置所有内容的可见性
            if (searchTerm === '') {
                document.querySelectorAll('section').forEach(section => {
                    section.style.display = 'block';
                });
                return;
            }
            
            // 遍历所有部分，只显示包含搜索词的部分
            document.querySelectorAll('section').forEach(section => {
                const sectionText = section.textContent.toLowerCase();
                if (sectionText.includes(searchTerm)) {
                    section.style.display = 'block';
                } else {
                    section.style.display = 'none';
                }
            });
        });
        
        // 平滑滚动
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                document.querySelector(targetId).scrollIntoView({
                    behavior: 'smooth'
                });
                
                // 移动端关闭侧边栏
                if (!tocSidebar.classList.contains('hidden') && window.innerWidth < 1024) {
                    tocSidebar.classList.add('hidden');
                    tocSidebar.classList.remove('fixed', 'inset-0', 'w-full', 'z-50', 'h-full');
                }
            });
        });
    </script>
</body>
</html>
